#+TITLE: Simulation scenario
#+Author: Thomas Alexander Gerds
#+Date: 
#+EMAIL: tag@biostat.ku.dk
#+LaTeX_CLASS: org-article
#+OPTIONS: toc:nil
#+LaTeX_HEADER:\usepackage{authblk}
#+LaTeX_HEADER:\usepackage{natbib}
#+LaTeX_HEADER:\author{Thomas Alexander Gerds}
#+LaTeX_HEADER:\affil{Department of Biostatistics, University of Copenhagen}
#+setupfile:~/emacs-genome/snps/org-templates/setup-all-purpose.org
# #+superman-org-export-target: pdf

* COMMENT ChatGPT

I need your help to describe a realistic simulation scenario where all
people start on a treatment, A(t)=1 for t=0 and all people are free
from stroke at time zero, L(0)=0. During a maximum followup time of 2
years people can have a stroke and they can at a doctor visit decide
to stop treatment. At any time the individuals can die and the outcome
is the risk of death within 2 years. People who stop treatment cannot
start again. We would like to parametrize a scenario in continuous
time were the treatment stop probability depends on the stroke status
and the risk of stroke depends on the treatment history. first
scheduled doctor visit is after 1 year (plus/minus 30 days) unless
stroke occurs. if stroke occurs the doctor visit will be more likely
to happen shortly after the stroke but the likelihood of stopping the
treatment is lower when stroke occurs.  Can you provide us with a
comprehensive description of the simulation scenario which is a)
understandable for our clinical collaborators, b) suitable to be
presented in our manuscript, that is including suitable mathematical
notation and propose which parameters we should vary to test our
estimation procedure?

* Simulation Scenario: Treatment Discontinuation, Stroke, and Death in Continuous Time

We simulate a cohort of patients who initiate treatment at time \( t = 0 \), denoted by \( A(t) = 1 \) for all \( t \geq 0 \), and who are initially stroke-free, \( L(0) = 0 \). All individuals are followed for up to 2 years (730 days) or until death. During follow-up, patients may experience a stroke, stop treatment (irreversibly), and die. The primary outcome is the *risk of death within 2 years*.

**Key Event Processes**
We model the following time-to-event processes in continuous time:

- *Stroke occurrence*: Hazard depends on current treatment status.
- *Treatment discontinuation*: Allowed only at scheduled visits, influenced by stroke status.
- *Death*: Hazard depends on treatment and stroke history.

* Model Notation and Structure
Let:

- \( T_{\text{stroke}} \): time to stroke
- \( T_{\text{stop}} \): time of treatment discontinuation
- \( T_{\text{death}} \): time of death
- \( C = 730 \): administrative censoring at 2 years
- \( A(t) \in \{0, 1\} \): treatment status at time \( t \)
- \( L(t) \in \{0, 1\} \): stroke status (1 = stroke has occurred)

Initial conditions:

#+begin_export latex
\[
A(0) = 1,\quad L(0) = 0
\]
#+end_export

** 1. Stroke Process
Stroke occurs at hazard:

#+begin_export latex
\[
\lambda_{\text{stroke}}(t) = \lambda_0^{\text{stroke}} \cdot \exp\left( \beta_A \cdot A(t) \right)
\]
#+end_export

- \( \lambda_0^{\text{stroke}} \): baseline hazard
- \( \beta_A \): treatment effect on stroke

** 2. Doctor Visit Process
- If no stroke: visit at \( t \sim \text{Uniform}(335, 395) \)
- If stroke occurs first:
  #+begin_export latex
  \[
  t_{\text{visit}} \sim \text{Gamma}(\alpha_{\text{stroke}}, \theta_{\text{stroke}}) + T_{\text{stroke}}
  \]
  #+end_export

** 3. Treatment Discontinuation Process
Can only occur at visit time. Probability of stopping depends on stroke status:

#+begin_export latex
\[
\Pr\left(A(t_{\text{visit}}^+) = 0 \mid A(t_{\text{visit}}^-) = 1\right) =
\begin{cases}
p_{\text{no-stroke}}, & \text{if } L(t_{\text{visit}}) = 0 \\
p_{\text{stroke}}, & \text{if } L(t_{\text{visit}}) = 1
\end{cases}
\]
#+end_export

Treatment is irreversible: once stopped, \( A(t) = 0 \) for all \( t > T_{\text{stop}} \).

** 4. Death Process
Hazard of death depends on stroke and treatment:

#+begin_export latex
\[
\lambda_{\text{death}}(t) = \lambda_0^{\text{death}} \cdot \exp\left( \gamma_L \cdot L(t) + \gamma_A \cdot A(t) \right)
\]
#+end_export

- \( \lambda_0^{\text{death}} \): baseline hazard
- \( \gamma_L \): effect of stroke
- \( \gamma_A \): effect of treatment

* Censoring and Outcome

Define:

#+begin_export latex
\[
T = \min(T_{\text{death}}, C), \quad \Delta = I(T_{\text{death}} \leq C)
\]
\[
Y = I(T_{\text{death}} \leq 730)
\]
#+end_export

Our outcome is the indicator for death within 2 years.

* Suggested Parameters for Sensitivity/Estimation

| Parameter                 | Description                                | Example Values     |
|--------------------------+--------------------------------------------+--------------------|
| \( \lambda_0^{\text{stroke}} \) | Baseline stroke hazard                  | 0.002 per day      |
| \( \beta_A \)            | Treatment effect on stroke                 | -0.5, 0, 0.5       |
| \( p_{\text{no-stroke}} \) | Stop prob. at visit (no stroke)           | 0.3                |
| \( p_{\text{stroke}} \)  | Stop prob. at visit (post-stroke)          | 0.05               |
| \( \lambda_0^{\text{death}} \) | Baseline death hazard                  | 0.001 per day      |
| \( \gamma_L \)           | Effect of stroke on death                  | 1.5                |
| \( \gamma_A \)           | Treatment effect on death                  | -0.5, 0, 0.5       |
| \( \alpha, \theta \)     | Post-stroke visit delay (Gamma params)     | (2, 7)             |
| Jitter window            | Timing of first visit                      | Â±30 days           |

* Plain Language Summary (for Clinical Audience)

We simulate patients who all begin treatment and are initially healthy. Over two years, they may have a stroke, stop treatment (only at doctor visits), or die. A routine doctor visit is scheduled about a year after treatment begins, unless a stroke happens first, in which case a visit is likely to occur soon after. Doctors are less likely to stop treatment after a stroke. The chance of dying depends on whether the patient has had a stroke and whether they are still on treatment.
